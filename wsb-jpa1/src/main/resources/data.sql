DROP TABLE IF EXISTS address CASCADE;
DROP TABLE IF EXISTS doctor CASCADE;
DROP TABLE IF EXISTS patient CASCADE;
DROP TABLE IF EXISTS visit CASCADE;
DROP TABLE IF EXISTS medical_treatment CASCADE;

CREATE TABLE IF NOT EXISTS address
(
    id            BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    city          VARCHAR(255),
    address_line1 VARCHAR(255),
    address_line2 VARCHAR(255),
    postal_code   VARCHAR(255),
    CONSTRAINT pk_address PRIMARY KEY (id)
    );

CREATE TABLE IF NOT EXISTS doctor
(
    id               BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    first_name       VARCHAR(255)                            NOT NULL,
    last_name        VARCHAR(255)                            NOT NULL,
    telephone_number VARCHAR(255)                            NOT NULL,
    email            VARCHAR(255),
    doctor_number    VARCHAR(255)                            NOT NULL,
    specialization   VARCHAR(255)                            NOT NULL,
    address_id       BIGINT                                  NOT NULL,
    CONSTRAINT pk_doctor PRIMARY KEY (id)
    );

CREATE TABLE IF NOT EXISTS patient
(
    id               BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    first_name       VARCHAR(255)                            NOT NULL,
    last_name        VARCHAR(255)                            NOT NULL,
    telephone_number VARCHAR(255)                            NOT NULL,
    email            VARCHAR(255),
    patient_number   VARCHAR(255)                            NOT NULL,
    date_of_birth    date                                    NOT NULL,
    address_id       BIGINT                                  NOT NULL,
    CONSTRAINT pk_patient PRIMARY KEY (id)
    );

CREATE TABLE IF NOT EXISTS visit
(
    id          BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    description VARCHAR(255),
    time        TIMESTAMP                               NOT NULL,
    doctor_id   BIGINT,
    patient_id  BIGINT,
    CONSTRAINT pk_visit PRIMARY KEY (id)
    );

CREATE TABLE IF NOT EXISTS medical_treatment
(
    id          BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    description VARCHAR(255)                            NOT NULL,
    type        VARCHAR(255),
    visit_id    BIGINT,
    CONSTRAINT pk_medical_treatment PRIMARY KEY (id)
    );

-- Relacja jednostronna od strony dziecka: każda tabela doctor musi mieć adres
ALTER TABLE doctor
    ADD CONSTRAINT IF NOT EXISTS FK_DOCTOR_ON_ADDRESS FOREIGN KEY (address_id) REFERENCES address (id);

-- Relacja jednostronna od strony dziecka: każda tabela patient musi mieć adres
ALTER TABLE patient
    ADD CONSTRAINT IF NOT EXISTS FK_PATIENT_ON_ADDRESS FOREIGN KEY (address_id) REFERENCES address (id);

-- Relacja dwustronna: visit jest powiązany z doctor (doctor_id) i odwrotnie
ALTER TABLE visit
    ADD CONSTRAINT IF NOT EXISTS FK_VISIT_ON_DOCTOR FOREIGN KEY (doctor_id) REFERENCES doctor (id);

-- Relacja dwustronna: visit jest powiązany z patient (patient_id) i odwrotnie
ALTER TABLE visit
    ADD CONSTRAINT IF NOT EXISTS FK_VISIT_ON_PATIENT FOREIGN KEY (patient_id) REFERENCES patient (id);

-- Relacja jednostronna od strony dziecka: medical_treatment należy do visit
ALTER TABLE medical_treatment
    ADD CONSTRAINT IF NOT EXISTS FK_MEDICAL_TREATMENT_ON_VISIT FOREIGN KEY (visit_id) REFERENCES visit (id);


ALTER TABLE doctor
    ADD CONSTRAINT IF NOT EXISTS uc_doctor_address UNIQUE (address_id);

ALTER TABLE patient
    ADD CONSTRAINT IF NOT EXISTS uc_patient_address UNIQUE (address_id);






INSERT INTO ADDRESS (ID, ADDRESS_LINE1, ADDRESS_LINE2, CITY, POSTAL_CODE)
VALUES (901, '300 Health Blvd', 'Unit 5', 'Los Angeles', '90001'),
       (902, '456 Elm St', 'Suite 2A', 'San Francisco', '94105'),
       (903, '12 Ocean Ave', 'Penthouse', 'San Diego', '92101'),
       (904, '890 Maple Road', NULL, 'Houston', '77002'),
       (905, '678 Cedar Lane', 'Building B', 'Austin', '73301');

INSERT INTO DOCTOR (ID, FIRST_NAME, LAST_NAME, TELEPHONE_NUMBER, EMAIL, DOCTOR_NUMBER, SPECIALIZATION, ADDRESS_ID)
VALUES (123, 'Alice', 'Brown', '987654321', 'abrown@gmail.com', '111222', 'CARDIOLOGIST', 901),
       (124, 'David', 'Clark', '555987654', 'dclark@hospital.com', '333444', 'PEDIATRICIAN', 902),
       (125, 'Sophia', 'Lopez', '555876543', 'slopez@hospital.com', '555666', 'NEUROLOGIST', 904),
       (126, 'James', 'Wright', '555765432', 'jwright@hospital.com', '777888', 'ORTHOPEDIST', 905);

INSERT INTO PATIENT (ID, FIRST_NAME, LAST_NAME, TELEPHONE_NUMBER, EMAIL, PATIENT_NUMBER, DATE_OF_BIRTH, ADDRESS_ID)
VALUES (22, 'Liam', 'Davis', '555123456', 'ldavis@gmail.com', '12345', '1995-06-15', 903),
       (23, 'Emma', 'Harris', '555234567', 'eharris@email.com', '54321', '1992-12-25', 902),
       (24, 'Noah', 'Martinez', '555345678', 'nmartinez@email.com', '67890', '1980-02-10', 905);

INSERT INTO VISIT (ID, DESCRIPTION, TIME, DOCTOR_ID, PATIENT_ID)
VALUES (48, 'Routine Check', '2025-05-01 11:00:00', 123, 22),
       (49, 'Annual Exam', '2025-04-10 10:30:00', 124, 23),
       (50, 'Specialist Consult', '2025-04-15 13:00:00', 125, 24),
       (51, 'Therapy Session', '2025-04-05 14:45:00', 126, 23);

INSERT INTO MEDICAL_TREATMENT (ID, DESCRIPTION, TYPE, VISIT_ID)
VALUES (101, 'Cardiac Assessment', 'MRI', 49),
       (102, 'Kidney Scan', 'CT', 49),
       (103, 'Lung Imaging', 'X-Ray', 50),
       (104, 'Retinal Scan', 'OCT', 51),
       (105, 'Spinal MRI', 'MRI', 48);
